---

- name: Install Packages (Ubuntu)
  apt:
    state: present
    name:
      - ntp
      - ntpstat
      - ntpdate
  when: ansible_distribution == "Ubuntu"

- name: Install Packages (CentOS)
  yum:
    state: present
    name:
      - ntp
      - ntpdate
  when: ansible_distribution == "CentOS"

- name: Set default NTP service name
  set_fact:
    ntp_service: ntp
    ntp_service_state: "started"

- name: Set NTP service name (CentOS)
  set_fact:
    ntp_service: ntpd
  when: ansible_distribution == "CentOS"

- name: Update NTP configuration
  template:
    dest: /etc/ntp.conf
    group: root
    owner: root
    mode: 0644
    src: ntp.conf.j2
  register: ntp_config

- name: NTP refresh
  set_fact:
    ntp_service_state: "restarted"
  when: ntp_config.changed

- name: NTP Service Enable
  service:
    name: "{{ ntp_service }}"
    state: "{{ ntp_service_state }}"
    enabled: yes

- name: Enable services (Ubuntu)
  service:
    name: "{{ item }}"
    state: started
    enabled: true
  loop:
    - ntp
  when: ansible_distribution == "Ubuntu"

- name: Enable services (CentOS)
  service:
    name: "{{ item }}"
    state: started
    enabled: true
  loop:
    - ntpd
  when: ansible_distribution == "CentOS"

...
